<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Add Interact Club | Interact Global Hub</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<!-- Leaflet CSS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #f4f7fb;
    margin: 0;
  }

  header {
    background: #0a74da;
    color: white;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  header a {
    color: white;
    text-decoration: none;
    font-weight: 600;
  }

  .container {
    max-width: 520px;
    margin: 3rem auto;
    background: white;
    padding: 2rem;
    border-radius: 14px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.08);
  }

  h1 {
    text-align: center;
    margin-bottom: 1.5rem;
    color: #222;
  }

  input {
    width: 100%;
    padding: 0.9rem;
    margin-bottom: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 0.95rem;
  }

  #map {
    height: 250px;
    border-radius: 10px;
    margin-bottom: 1.2rem;
  }

  ul {
    list-style: none;
    padding: 0;
    margin-top: -0.8rem;
    margin-bottom: 1rem;
    border: 1px solid #ddd;
    border-radius: 6px;
    max-height: 180px;
    overflow-y: auto;
    background: white;
  }

  li {
    padding: 0.6rem;
    cursor: pointer;
    font-size: 0.9rem;
    border-bottom: 1px solid #eee;
  }

  li:hover {
    background: #f0f4ff;
  }

  button {
    width: 100%;
    padding: 1rem;
    background: #0a74da;
    color: white;
    border: none;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
  }

  button:hover {
    background: #095bb0;
  }

  .note {
    text-align: center;
    font-size: 0.85rem;
    color: #666;
    margin-top: 1rem;
  }
</style>
</head>
<body>

<header>
  <a href="index.html">‚Üê Home</a>
  <span>Add Interact Club</span>
</header>

<div class="container">
  <h1>Add Your Club</h1>

  <form id="clubForm">
    <input type="text" name="name" placeholder="Interact Club Name" required>

    <input
      type="text"
      id="locationSearch"
      placeholder="Search city or address"
      autocomplete="off"
      required
    >
    <ul id="suggestions"></ul>

    <div id="map"></div>

    <input type="hidden" id="city">
    <input type="hidden" id="country">
    <input type="hidden" id="lat">
    <input type="hidden" id="lng">

    <input type="email" name="email" placeholder="Club Email (optional)">
    <input type="url" name="instagram" placeholder="Instagram Link (optional)">
    <input type="tel" name="phone" placeholder="Phone Number (optional)">

    <button type="submit">Add Club</button>
  </form>

  <div class="note">
    Clubs will appear after verification üåç
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzyyfdmgVrDlLL-HOc1kOqndenis6PueCK_eG5tj5Lt4SwGM584CrwJddzLJAiUPtPnIg/exec";

/* ---------- MAP SETUP ---------- */
const map = L.map("map").setView([0, 0], 2);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "¬© OpenStreetMap"
}).addTo(map);

let marker;

/* ---------- AUTOCOMPLETE ---------- */
const searchInput = document.getElementById("locationSearch");
const suggestions = document.getElementById("suggestions");

searchInput.addEventListener("input", async () => {
  const query = searchInput.value.trim();
  if (query.length < 3) {
    suggestions.innerHTML = "";
    return;
  }

  const res = await fetch(
    `https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&q=${encodeURIComponent(query)}`
  );
  const places = await res.json();

  suggestions.innerHTML = "";
  places.forEach(place => {
    const li = document.createElement("li");
    li.textContent = place.display_name;

    li.onclick = () => {
      const lat = parseFloat(place.lat);
      const lng = parseFloat(place.lon);

      document.getElementById("lat").value = lat;
      document.getElementById("lng").value = lng;
      document.getElementById("city").value =
        place.address.city || place.address.town || place.address.village || "";
      document.getElementById("country").value =
        place.address.country || "";

      searchInput.value = place.display_name;
      suggestions.innerHTML = "";

      map.setView([lat, lng], 13);
      if (marker) map.removeLayer(marker);
      marker = L.marker([lat, lng], { draggable: true }).addTo(map);

      marker.on('dragend', () => {
        const pos = marker.getLatLng();
        document.getElementById("lat").value = pos.lat;
        document.getElementById("lng").value = pos.lng;
      });
    };

    suggestions.appendChild(li);
  });
});

/* ---------- MAP CLICK ---------- */
map.on('click', function(e) {
  const lat = e.latlng.lat;
  const lng = e.latlng.lng;

  document.getElementById("lat").value = lat;
  document.getElementById("lng").value = lng;

  if (marker) map.removeLayer(marker);
  marker = L.marker([lat, lng], { draggable: true }).addTo(map);

  marker.on('dragend', () => {
    const pos = marker.getLatLng();
    document.getElementById("lat").value = pos.lat;
    document.getElementById("lng").value = pos.lng;
  });
});

/* ---------- FORM SUBMIT (FIXED) ---------- */
document.getElementById("clubForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const payload = {
    name: e.target.name.value.trim(),
    city: document.getElementById("city").value.trim(),
    country: document.getElementById("country").value.trim(),
    lat: document.getElementById("lat").value.trim(),
    lng: document.getElementById("lng").value.trim(),
    email: e.target.email.value.trim(),
    instagram: e.target.instagram.value.trim(),
    phone: e.target.phone.value.trim()
  };

  if (!payload.name) return alert("Club name is required");
  if (!payload.lat || !payload.lng) return alert("Please select a location");

  try {
    const response = await fetch(scriptURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    await response.text(); // üî• FIX: don't parse JSON

    alert("‚úÖ Club submitted successfully!");
    e.target.reset();
    if (marker) map.removeLayer(marker);
    map.setView([0, 0], 2);

  } catch (err) {
    alert("‚ùå Submission failed");
    console.error(err);
  }
});
</script>

</body>
</html>

